@using webbanhangmvc.Models;
@model Cart
@using X.PagedList.Mvc.Core;
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    Layout = null;
}
<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="VaLiKing Store">
    <meta name="keywords" content="Ogani, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>VaLiKing Store | Template</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;600;900&display=swap" rel="stylesheet">

    <!-- Css Styles -->
    <link rel="stylesheet" href="../1LayoutOgani/css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="../1LayoutOgani/css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="../1LayoutOgani/css/elegant-icons.css" type="text/css">
    <link rel="stylesheet" href="../1LayoutOgani/css/nice-select.css" type="text/css">
    <link rel="stylesheet" href="../1LayoutOgani/css/jquery-ui.min.css" type="text/css">
    <link rel="stylesheet" href="../1LayoutOgani/css/owl.carousel.min.css" type="text/css">
    <link rel="stylesheet" href="../1LayoutOgani/css/slicknav.min.css" type="text/css">
    <link rel="stylesheet" href="../1LayoutOgani/css/style13.css" type="text/css">
    <link rel="shortcut icon" href="../../LayoutAdmin/assets/images/favicon1.png" />

</head>
<body>
    <!-- Page Preloder -->
    <div id="preloder">
        <div class="loader"></div>
    </div>

    <div class="humberger__menu__overlay"></div>
    <div class="humberger__menu__wrapper">
        <div class="humberger__menu__logo">
            <a href="@Url.Action("Index","Home")"><img src="../1LayoutOgani/img/logo0.png" alt=""></a>
        </div>
        <div class="humberger__menu__cart">
            <ul>
                <li><a href="#"><i class="fa fa-heart"></i> </a></li>
                <li><a href="@Url.Action("Cart","Cart")"><i class="fa fa-shopping-bag"></i> </a></li>
            </ul>
            
        </div>
        <div class="humberger__menu__widget">
            @*<div class="header__top__right__language">
                <img src="../1LayoutOgani/img/language0.png" alt="">
                <div>Tiếng Việt</div>
                <span class="arrow_carrot-down"></span>
                <ul>
                    <li><a href="#">Tiếng Việt</a></li>
                    <li><a href="#">English</a></li>
                </ul>
            </div>*@
            <div class="header__top__right__auth">
                @*<a href="#"><i class="fa fa-user"></i> Login</a>*@
                @*<a asp-controller="Acces" asp-action="Logout" ><i class="fa fa-user"></i> Logout</a>*@
            </div>
        </div>
        <nav class="humberger__menu__nav mobile-menu">
            <ul>
                <li class="active"><a href="@Url.Action("Index","Home")">Trang Chủ</a></li>
                <li><a href="#">Trang</a>
                    <ul class="header__menu__dropdown">
                        <li><a asp-controller="Home" asp-action="ProductDetail">Chi Tiết Cửa Hàng</a></li>
                        <li><a  asp-controller="Cart" asp-action="Cart">Giỏ Hàng Shop</a></li>
                        <li><a asp-controller="Cart" asp-action="KiemTraDon">Kiểm Tra Đơn Hàng</a></li>
                        
                    </ul>
                </li>
                <li><a asp-controller="Home" asp-action="Tintuc">Tin Tức</a></li>
                <li><a  asp-controller="Home" asp-action="Lienhe">>Liên Hệ</a></li>
            </ul>
        </nav>
        <div id="mobile-menu-wrap"></div>
        <div class="header__top__right__social">
            <a href="#"><i class="fa fa-facebook"></i></a>
            <a href="#"><i class="fa fa-twitter"></i></a>
            <a href="#"><i class="fa fa-linkedin"></i></a>
            <a href="#"><i class="fa fa-pinterest-p"></i></a>
        </div>
        <div class="humberger__menu__contact">
            <ul>
                <li><i class="fa fa-envelope"></i> Valiking010@gmail.com</li>
                
            </ul>
        </div>
    </div>
    <!-- Humberger End -->

    <!-- Header Section Begin -->
    <header class="header">
        <div class="header__top">
            <div class="container">
                <div class="row">
                    <div class="col-lg-6 col-md-6">
                        <div class="header__top__left">
                            <ul>
                                <li><a href="https://mail.google.com/mail/u/0/#inbox?compose=jrjtWvNPGmnWVCTgksjLjHdmWmRrNLCVpLHJlmhXDvqWlDSJbnprvbLhPBqgWZdQVkTxRhhW"><i class="fa fa-envelope"></i></a> VaLiKing010@gmail.com</li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-6">
                        <div class="header__top__right">
                            <div class="header__top__right__social">
                                <a href="https://web.facebook.com/LEVIETCONG.CLONE1"><i class="fa fa-facebook"></i></a>
                                <a href="https://twitter.com/"><i class="fa fa-twitter"></i></a>
                                <a href="https://www.linkedin.com/"><i class="fa fa-linkedin"></i></a>
                                <a href="https://www.pinterest.com"><i class="fa fa-pinterest-p"></i></a>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-lg-3">
                    <div class="header__logo">
                        <a href="../Home/Index"><img src="../1LayoutOgani/img/logo0.png" alt="" ></a>
                    </div>
                </div>
                <div class="col-lg-6">
                    <nav class="header__menu">
                        <ul>
                            <li class="active"><a href="@Url.Action("Index","Home")">Trang Chủ</a></li>
                            <li><a href="#">Trang</a>
                                <ul class="header__menu__dropdown">
                                    <li><a href="@Url.Action("RandomProductDetail", "Home")" >Chi Tiết Của Hàng</a></li>
                                    <li><a asp-controller="Home" asp-action="Giohang">Giỏ Hàng</a></li>
                                    <li><a asp-controller="Cart" asp-action="KiemTraDon">Kiểm Tra Đơn Hàng</a></li>
                                </ul>
                            </li>
                            <li><a asp-controller="Home" asp-action="TinTuc" >Tin Tức</a></li>
                            <li><a asp-controller="Home" asp-action="Lienhe" >Liên Hệ</a></li>
                        </ul>
                    </nav>
                </div>
                <div class="col-lg-3">
@await Component.InvokeAsync("CartWidgt") 

                </div>

            </div>
            <div class="humberger__open">
                <i class="fa fa-bars"></i>

            </div>
        </div>
    </header>

<!-- Header Section End -->
        <!-- Checkout Section Begin -->
<section class="checkout spad">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <h6><span class="icon_tag_alt"></span> Có Phiếu Giảm Giá ? <a asp-controller="Cart" asp-action="Cart">Nhấn Vào Đây</a> Để Nhập Mã Của Bạn
                    </h6>
                </div>
            </div>
            <div class="checkout__form">
                <h4>Chi TIết Thanh Toán</h4>
       @*         <form>*@
                <form action="@Url.Action("Checkout", "Cart")" method="post">
                    <div class="row">
                        <div class="col-lg-8 col-md-6">
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="checkout__input">
                                        <p>Họ<span>*</span></p>
                                        <input type="text" name="ho" id="ho">
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="checkout__input">
                                        <p>Tên<span>*</span></p>
                                        <input type="text" name="name" id="name">
                                    </div>
                                </div>
                            </div>
                            <div class="checkout__input">
        <p>Địa Chỉ <span>*</span></p>
        <input type="text" id="address" name="address">
    </div>
                            <div class="checkout__input">
                                <p> Mã Zip / ZIP<span></span></p>
                                <input type="text">
                            </div>
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="checkout__input">
                                        <p>Điện Thoại<span>*</span></p>
                                        <input type="text" name="phone" id="phone">
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="checkout__input">
                                        <p>Email<span></span></p>
                                        <input type="text" id="email">
                                    </div>
                                </div>
                            </div>
                            <div class="checkout__input__checkbox">
                                <label for="diff-acc">
                                    Gửi Đến Địa Chỉ Khác?
                                    <input type="checkbox" id="diff-acc">
                                    <span class="checkmark"></span>
                                </label>
                            </div>
                            <div class="checkout__input">
                                <p>Ghi Chú Đặt Hàng<span></span></p>
                                <input type="text"
                                    placeholder="Ghi Chú Về Đơn Hàng Của Bạn">
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <div class="checkout__order">
                                <h4>Đơn Hàng Của Bạn</h4>
                                <div class="checkout__order__products">Sản Phẩm <span>Số Lượng</span></div>
                                <ul>
    @foreach(var line in Model?.lines)
    {
        <li>
            <input type="hidden" name="sp" id="sp" value="@line.Product.TenSp">
             @line.Product.TenSp  <span>@line.Quantity</span>
        </li>
    }
</ul>
                                <div class="checkout__order__total" >Tổng tiền <span> @String.Format("{0:#,##0}", Model.ComputeToTalValue()) VNĐ. </span></div>
                                <div>
<div>
    <label for="paymentMethod">Phương thức thanh toán:</label>
    <select id="paymentMethod" name="paymentMethod" onchange="handleSelectChange()">
        <option value="Thanh Toán Khi Nhận Hàng">Thanh Toán Khi Nhận Hàng</option>
        <option value="Qua Ngân Hàng">Qua Ngân Hàng</option>
        <option value="Qua Ví VnPay">Qua Ví VnPay</option>
    </select>
</div>

<button type="button" class="site-btn" onclick="validateAndSubmit()">Đặt Hàng</button>


<script>
    function handleSelectChange() {
        var selectElement = document.getElementById("paymentMethod");
        var selectedValue = selectElement.value;
        // Xử lý các hành động dựa trên giá trị đã chọn
    }

    function validateAndSubmit() {
        // Lấy giá trị từ các trường đầu vào
        var ho = document.getElementById('ho').value;
        var name = document.getElementById('name').value;
        var address = document.getElementById('address').value;
        var phone = document.getElementById('phone').value;
        var paymentMethod = document.getElementById('paymentMethod').value;

        // Kiểm tra các trường đầu vào
        if (ho.trim()==='' ||name.trim() === '' || address.trim() === '' || phone.trim() === '') {
            alert('Vui lòng nhập đầy đủ thông tin tên, địa chỉ và số điện thoại.');
            return; // Ngăn chặn hành động tiếp theo nếu kiểm tra không đạt
        }

        // Xử lý phương thức thanh toán
        if (paymentMethod === 'Thanh Toán Khi Nhận Hàng') {
            // Xử lý thanh toán khi nhận hàng
            submitOrder(name, address, phone, paymentMethod);
        } else if (paymentMethod === 'Qua Ví VnPay') {
            // Chuyển hướng đến dịch vụ VNPay
            redirectToVNPay(name, address, phone, paymentMethod);
        }else if(paymentMethod === 'Qua Ngân Hàng'){
            redirectToNganHang(name,address,phone,paymentMethod);
        }
    }

    function submitOrder(name, address, phone, paymentMethod) {
        $.ajax({
            url: '/Cart/Checkout',
            type: 'POST',
            data: {
                name: name,
                address: address,
                phone: phone,
                paymentMethod: paymentMethod,
                tinhtrang: 'Thanh toán khi nhận hàng'
            },
            success: function(response) {
                alert('Đơn đặt hàng của bạn đã thành công, vui lòng thanh toán khi nhận hàng.');
                $.ajax({
                    url: '/Cart/RemoveCartSession',
                    type: 'POST',
                    success: function() {
                        window.location.reload();
                    }
                });
            },
            error: function() {
                alert('Đã xảy ra lỗi trong quá trình xử lý đơn hàng.');
            }
        });
    }

    function redirectToVNPay(name, address, phone, paymentMethod) {
        // Tạo một form và submit để chuyển hướng đến VNPay với phương thức POST
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/Cart/Checkout';

        const nameField = document.createElement('input');
        nameField.type = 'hidden';
        nameField.name = 'name';
        nameField.value = name;

        const addressField = document.createElement('input');
        addressField.type = 'hidden';
        addressField.name = 'address';
        addressField.value = address;

        const phoneField = document.createElement('input');
        phoneField.type = 'hidden';
        phoneField.name = 'phone';
        phoneField.value = phone;

        const paymentMethodField = document.createElement('input');
        paymentMethodField.type = 'hidden';
        paymentMethodField.name = 'paymentMethod';
        paymentMethodField.value = paymentMethod;

        form.appendChild(nameField);
        form.appendChild(addressField);
        form.appendChild(phoneField);
        form.appendChild(paymentMethodField);

        document.body.appendChild(form);
        form.submit();
    }

    function redirectToNganHang(name,address,phone,paymentMethod){
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '/Cart/CreateQrCode'; // URL để xử lý việc tạo mã QR

    const nameField = document.createElement('input');
    nameField.type = 'hidden';
    nameField.name = 'name';
    nameField.value = name;

    const addressField = document.createElement('input');
    addressField.type = 'hidden';
    addressField.name = 'address';
    addressField.value = address;

    const phoneField = document.createElement('input');
    phoneField.type = 'hidden';
    phoneField.name = 'phone';
    phoneField.value = phone;

    const paymentMethodField = document.createElement('input');
    paymentMethodField.type = 'hidden';
    paymentMethodField.name = 'paymentMethod';
    paymentMethodField.value = paymentMethod;

    form.appendChild(nameField);
    form.appendChild(addressField);
    form.appendChild(phoneField);
    form.appendChild(paymentMethodField);

    document.body.appendChild(form);
    form.submit();
    }
</script>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </section>
    <!-- Checkout Section End -->

        <!-- Footer Section Begin -->
     <footer class="footer spad">
        <div class="container">
            <div class="row">
                <div class="col-lg-3 col-md-6 col-sm-6">
                    <div class="footer__about">
                        <div class="footer__about__logo">
                            <a href="./index.html"><img src="../1LayoutOgani/img/logo0.png" alt=""></a>
                        </div>
                        <ul>
                            <li>Address: Phố Long Biên 1, Ngọc Lâm, Hà Nội </li>
                            <li>Phone: +84 34.333.196 </li>
                            <li>Email: VaLiKing010@gmail.com </li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6 col-sm-6 offset-lg-1">
                    <div class="footer__widget">
                        <h6>Liên Kết Hữu Ích</h6>
                        <ul>
                            <li><a href="#">Về Chúng Tôi</a></li>
                            <li><a href="#">Về Cửa Hàng Chúng Tôi</a></li>
                            <li><a href="#">Mua Sắm An Toàn</a></li>
                            <li><a href="#">Thông Tin Giao Hàng</a></li>
                            <li><a href="#">Chính Sách Bảo Mật</a></li>
                            <li><a href="#">Sơ Đồ Web</a></li>
                        </ul>
                        <ul>
                            <li><a href="#">Chúng Tôi Là Ai</a></li>
                            <li><a href="#">Dịch Vụ Của Chúng Tôi</a></li>
                            <li><a href="#">Dự Án</a></li>
                            <li><a href="#">Sự Tiếp Xúc</a></li>
                            <li><a href="#">Sáng Kiến</a></li>
                            <li><a href="#">Ý Kiến</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-4 col-md-12">
                    <div class="footer__widget">
                        <h6>Tham Gia Bản Tin Của Chúng Tôi </h6>
                        <p>Nhận thông tin cập nhật qua E-Mail về cửa hàng mới nhất và các ưu đãi đặc biệt</p>
                        <form action="#">
                            <input type="text" placeholder="Nhập Thư Của Bạn">
                            <button type="submit" class="site-btn">Đăng Ký</button>
                        </form>
                        <div class="footer__widget__social">
                            <a href="https://web.facebook.com/LEVIETCONG.CLONE1"><i class="fa fa-facebook"></i></a>
                            <a href="https://www.instagram.com/"><i class="fa fa-instagram"></i></a>
                            <a href="https://twitter.com/?lang=vi"><i class="fa fa-twitter"></i></a>
                            <a href="https://www.pinterest.com/"><i class="fa fa-pinterest"></i></a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="footer__copyright">
                        <div class="footer__copyright__text"><p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
   &copy; Valiking Company Since <script>document.write(new Date().getFullYear());</script> | This template is made with <i class="fa fa-heart" aria-hidden="true"></i> by <a href="https://colorlib.com/" target="_blank">Colorlib</a>
  <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p></div>
                        <div class="footer__copyright__payment"><img src="../1LayoutOgani/img/payment-item.png" alt=""></div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
       <script src="../1LayoutOgani/js/jquery-3.3.1.min.js"></script>
    <script src="../1LayoutOgani/js/bootstrap.min.js"></script>
    <script src="../1LayoutOgani/js/jquery.nice-select.min.js"></script>
    <script src="../1LayoutOgani/js/jquery-ui.min.js"></script>
    <script src="../1LayoutOgani/js/jquery.slicknav.js"></script>
    <script src="../1LayoutOgani/js/mixitup.min.js"></script>
    <script src="../1LayoutOgani/js/owl.carousel.min.js"></script>
    <script src="../1LayoutOgani/js/main.js"></script>
    <script src="../js/Tatol.js"></script>



</body>

</html>